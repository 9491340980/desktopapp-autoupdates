<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome back, {{ username }}!</h1>
        <p class="welcome-subtitle">Site: {{ siteId }} | Select a module to get started</p>
      </div>

      <!-- Search Bar -->
      <div class="search-section">
        <mat-icon class="search-icon">search</mat-icon>
        <input
          type="text"
          class="search-input"
          placeholder="Search modules or operations..."
          [(ngModel)]="searchQuery"
          (input)="onSearch($event)"
          autocomplete="off">
        <button
          *ngIf="searchQuery"
          class="clear-search-btn"
          (click)="clearSearch()"
          matTooltip="Clear search">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Menu Grid -->
  <div class="menu-grid-container">
    <!-- No Results Message -->
    <div *ngIf="filteredMenuItems.length === 0" class="no-results">
      <mat-icon class="no-results-icon">search_off</mat-icon>
      <h3>No modules found</h3>
      <p>Try adjusting your search term</p>
    </div>

    <!-- Menu Items Grid -->
    <div class="menu-grid" *ngIf="filteredMenuItems.length > 0">
      <ng-container *ngFor="let item of filteredMenuItems">
        <!-- Main Menu Card -->
        <mat-card
          class="menu-card"
          [class.selected]="isModuleSelected(item)"
          [class.has-submenu]="item.HasSubMenu"
          (click)="onMainMenuClick(item)"
          [matTooltip]="item.HasSubMenu ? 'Click to view operations' : 'Click to open'"
          matTooltipPosition="above">

          <div class="card-content">
            <!-- Icon/Image -->
            <div class="menu-icon-wrapper">
              <img
                [src]="getMenuImagePath(item)"
                [alt]="item.Title"
                class="menu-image"
                (error)="onImageError($event)">
              <mat-icon class="menu-icon-fallback">{{ item.Icon }}</mat-icon>
            </div>

            <!-- Title -->
            <div class="menu-title">{{ item.Title }}</div>

            <!-- Badge -->
            <!-- <div *ngIf="item.HasSubMenu" class="submenu-badge">
              <span>{{ getFilteredSubMenu(item).length }}</span>
            </div> -->

            <!-- Arrow for SubMenu -->
            <mat-icon *ngIf="item.HasSubMenu" class="expand-icon">
              {{ isModuleSelected(item) ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </div>
        </mat-card>

        <!-- Sub-Menu Expanded View -->
        <div
          *ngIf="item.HasSubMenu && isModuleSelected(item)"
          class="submenu-expanded">
          <div class="submenu-header">
            <h3>{{ item.Title }} Operations</h3>
            <button
              class="close-submenu-btn"
              (click)="closeSelectedModule(); $event.stopPropagation()">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <div class="submenu-grid">
            <div
              *ngFor="let subItem of getFilteredSubMenu(item)"
              class="submenu-item"
              (click)="onSubMenuClick(item, subItem)"
              [matTooltip]="subItem.Title"
              matTooltipPosition="above">

              <div class="submenu-icon-wrapper">
                <img
                  [src]="getSubMenuImagePath(item.Title, subItem)"
                  [alt]="subItem.Title"
                  class="submenu-image"
                  (error)="onImageError($event)">
                <mat-icon class="submenu-icon-fallback">{{ subItem.Icon }}</mat-icon>
              </div>

              <div class="submenu-title">{{ subItem.Title }}</div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
